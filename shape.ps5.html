<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Through Fluid Shape Hole with p5.js</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
<script>
    let bgImg;

    function preload() {
        // 背景画像をロード
        bgImg = loadImage('./assets/img/iphpne15_fv.png'); // 画像のパスを指定
    }

    function setup() {
        createCanvas(400, 400);
    }

    function draw() {
        background(bgImg); // 背景画像を表示

        let centerX = width / 2;
        let centerY = height / 2;
        let noiseScale = 0.02;

        // マスクを作成（穴の形状）
        let mask = createGraphics(width, height);
        mask.fill(0);
        mask.beginShape();
        for (let a = 0; a < TWO_PI; a += 0.1) {
            let xoff = cos(a) + 1;
            let yoff = sin(a) + 1;
            // Perlinノイズを使って形状を変化
            let r = map(noise(xoff * noiseScale + millis() * 0.001, yoff * noiseScale), 0, 1, 50, 150);
            let x = centerX + r * cos(a);
            let y = centerY + r * sin(a);
            mask.vertex(x, y);
        }
        mask.endShape(CLOSE);
        mask.filter(ERODE); // 形状のエッジを少し滑らかに

        // マスクを適用
        bgImg.mask(mask.get());

        image(bgImg, 0, 0);
    }
</script>
</body>
</html>
